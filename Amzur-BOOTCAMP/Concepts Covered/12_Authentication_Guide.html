<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Authentication for Full‑Stack Development</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121835; --ink:#e7ebff; --muted:#a9b3d6; --accent:#7aa2ff; --ok:#3ad29f; --warn:#ffd36b; --bad:#ff7a8a;
      --code-bg:#0f142a; --chip:#1b234a; --border:#223069;
    }
  html,body{height:100%; scroll-behavior: smooth;}
    body{margin:0; font-family:Inter,Segoe UI,system-ui,-apple-system,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background:radial-gradient(1200px 800px at 80% -10%, #1e2760 0, #0b1020 60%);} 
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1200px; margin:0 auto; padding:28px;}
  header{background:linear-gradient(90deg, rgba(122,162,255,.12), rgba(58,210,159,.12)); border:1px solid var(--border); padding:24px; border-radius:18px; box-shadow:0 10px 28px rgba(0,0,0,.25); text-align:center;}
  header h1{margin:.2rem 0 0; font-size:2rem; text-align:center;}
  header p{margin:.6rem 0 0; color:var(--muted); text-align:center;}

    .grid{display:grid; gap:16px}
    .toc{grid-template-columns:repeat(auto-fit, minmax(180px,1fr)); margin-top:18px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:16px}
    .chip{display:inline-block; padding:6px 10px; background:var(--chip); border:1px solid var(--border); color:var(--muted); border-radius:999px; font-size:.8rem; margin:4px 6px 0 0}

    h2{margin-top:42px; font-size:1.5rem}
    h3{margin-top:26px; font-size:1.12rem}
    p{line-height:1.6; color:#cdd5ff}
    ul,ol{line-height:1.6; color:#cdd5ff}

    code, pre{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    pre{background:var(--code-bg); border:1px solid var(--border); border-radius:12px; padding:14px; overflow:auto}
    code{background:var(--code-bg); border:1px solid var(--border); border-radius:6px; padding:2px 6px}

    table{width:100%; border-collapse:separate; border-spacing:0; margin:10px 0 18px; background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden}
    th, td{padding:12px 14px; vertical-align:top}
    th{background:#18204a; color:#e7ebff; text-align:left; position:sticky; top:0}
    tr+tr td{border-top:1px solid var(--border)}

    .kpi{display:grid; grid-template-columns:repeat(auto-fit, minmax(180px,1fr)); gap:12px}
    .kpi .card{display:flex; flex-direction:column; gap:6px}
    .kpi .big{font-size:1.4rem}
    .badge{font-weight:600;}
    .ok{color:var(--ok)} .bad{color:var(--bad)} .warn{color:var(--warn)}
    details{background:var(--panel); border:1px solid var(--border); padding:12px 16px; border-radius:12px}
    details summary{cursor:pointer; font-weight:600}
    .foot{margin:48px 0 80px; color:var(--muted); font-size:.9rem}
    .two{display:grid; grid-template-columns:1.2fr .8fr; gap:14px}
    @media (max-width: 960px){.two{grid-template-columns:1fr}}
  .toc-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-top: 18px;
      margin-bottom: 18px;
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(11, 16, 32, 0.95); /* fallback for sticky background */
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 12px 0;
    }
    section {
      scroll-margin-top: 80px;
    }
    .chip-link {
      display: inline-block;
      padding: 10px 22px;
      background: var(--chip);
      color: var(--muted);
      border-radius: 999px;
      font-size: 1rem;
      border: none;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .chip-link:hover {
      background: var(--accent);
      color: #fff;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <!-- <div class="chip">Guide</div><div class="chip">AuthN/AuthZ</div><div class="chip">Full‑Stack</div> -->
      <h1>Authentication in Full‑Stack Development</h1>
      <h1>Tools, Frameworks, Techniques, Benefits & Limitations</h1>
      <!-- <p>This single‑file HTML handbook distills practical know‑how for designing, building, and operating modern authentication systems across web, SPA, mobile, and microservice backends.</p> -->
    </header>

    <nav class="toc-chips">
      <a class="chip-link" href="#overview" title="Core concepts, mental model">Overview</a>
      <a class="chip-link" href="#factors" title="Passwords, OTP, WebAuthn, passkeys">Auth Factors</a>
      <a class="chip-link" href="#flows" title="Session vs Token; OAuth2/OIDC; PKCE">Flows</a>
      <a class="chip-link" href="#standards" title="OIDC, SAML, SCIM, FIDO2">Standards</a>
      <a class="chip-link" href="#frameworks" title="Server, client, gateways">Tools & Frameworks</a>
      <a class="chip-link" href="#tokens" title="JWT vs PASETO, cookies, storage">Token & Session Design</a>
      <a class="chip-link" href="#mfa" title="TOTP, SMS, Email, WebAuthn">MFA & Passwordless</a>
      <a class="chip-link" href="#web" title="CSRF, CORS, SameSite, rate limits">Modern Web & API Security Patterns</a>
      <a class="chip-link" href="#roles" title="RBAC, ABAC, ReBAC, policy engines">AuthZ Models</a>
      <a class="chip-link" href="#ops" title="Secrets, rotation, logging, privacy">Ops & Compliance</a>
      <a class="chip-link" href="#tradeoffs" title="Decision matrix">Benefits & Limitations</a>
      <a class="chip-link" href="#checklists" title="Threat model, rollout, testing">Checklists</a>
      <a class="chip-link" href="#snippets" title="Cookie, JWT, CSRF middleware">Snippets</a>
      <a class="chip-link" href="#glossary" style="margin-top:12px;display:inline-block;">Glossary</a>
    </nav>

  <section id="overview" style="scroll-margin-top:180px;">
      <h2>Overview</h2>
      <p><strong>Authentication (AuthN)</strong> verifies <em>who</em> the user or system is. <strong>Authorization (AuthZ)</strong> decides <em>what</em> they can do. Sound authentication balances UX, security, and maintainability while fitting compliance and threat models.</p>
    </section>
  <section id="factors" style="scroll-margin-top:120px;">
      <div>
        <h2>Authentication Factors</h2>
        <table style="width: 100%;">
          <tr><th>Factor</th><th>Examples</th><th>Benefits</th><th>Limitations</th></tr>
          <tr><td>Knowledge (Something you know)</td><td>Password, PIN, security answers</td><td>Ubiquitous, simple to deploy</td><td class="bad">Weak to reuse, phishing, credential stuffing</td></tr>
          <tr><td>Possession (Something you have)</td><td>TOTP app, hardware key, phone</td><td class="ok">Stronger with MFA; offline</td><td>Loss/theft risk; provisioning overhead</td></tr>
          <tr><td>Inherence (Something you are)</td><td>Biometrics (TouchID/FaceID)</td><td>Low friction, strong local binding</td><td>Privacy concerns; fallback needed</td></tr>
          <tr><td>Context / Risk</td><td>Device fingerprint, IP, velocity</td><td>Adaptive auth, step‑up challenges</td><td>False positives; data protection rules</td></tr>
        </table>
      </div>
    </section>

  <section id="flows" style="scroll-margin-top:180px;">
        <h2>Core Flows</h2>
        <style>
          .core-tab-container { margin-top: 18px; }
          .core-tab-buttons { display: flex; gap: 8px; margin-bottom: 0; }
          .core-tab-btn { background: var(--chip); border: 1px solid var(--border); color: var(--muted); border-radius: 8px 8px 0 0; padding: 8px 18px; cursor: pointer; font-size: 1rem; outline: none; }
          .core-tab-btn.active { background: var(--panel); color: var(--ink); border-bottom: 1px solid var(--panel); }
          .core-tab-content { background: var(--panel); border: 1px solid var(--border); border-radius: 0 0 12px 12px; padding: 18px; margin-top: -1px; }
          .core-tab-content > pre, .core-tab-content > ul, .core-tab-content > table, .core-tab-content > details { margin: 0; }
        </style>
        <div class="core-tab-container">
          <div class="core-tab-buttons">
            <button class="core-tab-btn active" onclick="showCoreTab(0)">Session vs Token</button>
            <button class="core-tab-btn" onclick="showCoreTab(1)">OAuth2/OIDC</button>
            <button class="core-tab-btn" onclick="showCoreTab(2)">Legacy/Enterprise</button>
          </div>
          <div class="core-tab-content" id="coretab0">
            <h3>Session (Cookie) vs Token (Bearer)</h3>
            <table style="width:100%">
              <tr><th>Approach</th><th>How it works</th><th>Benefits</th><th>Limitations</th><th>Best for</th></tr>
              <tr>
                <td>Server Sessions (Cookies)</td>
                <td>Server stores session; browser sends cookie automatically</td>
                <td>HttpOnly + SameSite protect against XSS/CSRF; easy revoke</td>
                <td>Stateful; horizontal scale requires distributed store</td>
                <td>Traditional web, SSR, dashboards</td>
              </tr>
              <tr>
                <td>JWT / PASETO (Bearer)</td>
                <td>Self‑contained token signed by IdP; API verifies signature</td>
                <td>Stateless; easy API fan‑out; mobile/SPA friendly</td>
                <td>Revocation hard; size; clock skew; needs rotation</td>
                <td>SPAs, mobile, microservices</td>
              </tr>
            </table>
          </div>
          <div class="core-tab-content" id="coretab1" style="display:none;">
            <h3>OAuth2 + OpenID Connect (OIDC)</h3>
            <ul>
              <li><strong>Authorization Code + PKCE</strong> for SPAs & mobile (front‑channel code, back‑channel token).</li>
              <li><strong>Client Credentials</strong> for service‑to‑service.</li>
              <li><strong>Device Code</strong> for TVs/CLI.</li>
            </ul>
            <details><summary>Typical OIDC sequence (Authorization Code + PKCE)</summary>
              <ol>
                <li>Client creates <code>code_verifier</code> and <code>code_challenge</code> (SHA‑256).</li>
                <li>Redirect to <code>/authorize</code> with <code>code_challenge</code>, scopes, and <code>state</code>.</li>
                <li>User authenticates at IdP; IdP returns <code>code</code> to redirect_uri.</li>
                <li>Client sends <code>code</code> + <code>code_verifier</code> to <code>/token</code> to obtain <code>id_token</code>, <code>access_token</code>, and optional <code>refresh_token</code>.</li>
                <li>Use <code>access_token</code> for APIs; renew via refresh or silent reauth.</li>
              </ol>
            </details>
          </div>
          <div class="core-tab-content" id="coretab2" style="display:none;">
            <h3>Legacy / Enterprise</h3>
            <ul>
              <li><strong>SAML 2.0</strong> for enterprise SSO with older IdPs.</li>
              <li><strong>LDAP/AD</strong> for intranet binds; often fronted by IdP.</li>
            </ul>
          </div>
        </div>
      </section>

  <section id="standards" style="scroll-margin-top:180px;">
      <h2>Standards & Specs</h2>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr))">
        <div class="card"><h3>OIDC</h3><p>Identity layer on OAuth2, issues <code>id_token</code> (user claims) and access tokens. Preferred for modern web & mobile.</p></div>
        <div class="card"><h3>SAML 2.0</h3><p>XML‑based federation for enterprise SSO. Verbose, but widely deployed in B2B.</p></div>
        <div class="card"><h3>FIDO2/WebAuthn</h3><p>Public‑key auth with hardware/platform authenticators; foundation for passkeys.</p></div>
        <div class="card"><h3>SCIM</h3><p>Standard for provisioning users & groups across systems.</p></div>
      </div>
    </section>

  <section id="frameworks" style="scroll-margin-top:180px;">
      <h2>Tools & Frameworks</h2>
      <table>
        <tr><th>Layer</th><th>Options</th><th>Benefits</th><th>Limitations</th></tr>
        <tr>
          <td>Identity Providers (IdP)</td>
          <td>Auth0, Azure AD B2C/Entra, Okta, Keycloak, FusionAuth, Cognito, Supabase Auth</td>
          <td>Hosted flows, social login, MFA, policies, enterprise connectors</td>
          <td>Vendor lock‑in, pricing, migration complexity</td>
        </tr>
        <tr>
          <td>Server Frameworks</td>
          <td>Node: NextAuth/Auth.js, Passport; Java: Spring Authorization Server; Python: FastAPI + auth libs; Go: Ory/Hydra, Dex</td>
          <td>Flexibility, local control</td>
          <td>DIY security hardening, updates & patches</td>
        </tr>
        <tr>
          <td>API Gateways</td>
          <td>Kong, Tyk, NGINX, Envoy, API Gateway (cloud), Traefik</td>
          <td>Centralized authN/Z, rate limits, JWT verification</td>
          <td>Extra hop, config complexity</td>
        </tr>
        <tr>
          <td>Policy Engines</td>
          <td>OPA/Styra, Cedar, Zanzibar‑style (openfga), Casbin</td>
          <td>Decouple authZ, fine‑grained control, audit</td>
          <td>Learning curve; latency if remote</td>
        </tr>
      </table>
    </section>

  <section id="tokens" style="scroll-margin-top:180px;">
      <h2>Token, Session & Storage Design</h2>
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 18px; margin-top: 18px;">
        <div class="card">
          <h3>Cookies</h3>
          <ul>
            <li><code>HttpOnly</code>, <code>Secure</code>, <code>SameSite=Lax/Strict</code>; set short expiration.</li>
            <li>CSRF tokens for state‑changing POST/PUT/DELETE (double submit or synchronized token).</li>
          </ul>
        </div>
        <div class="card">
          <h3>JWT vs PASETO</h3>
          <ul>
            <li><strong>JWT</strong>: widely supported; use strong alg (<code>RS256/ES256</code>); verify <code>aud</code>, <code>iss</code>, <code>exp</code>, <code>nbf</code>.</li>
            <li><strong>PASETO</strong>: safer defaults; simpler semantics; smaller ecosystem.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Refresh Strategy</h3>
          <ul>
            <li>Rotate refresh tokens on use; bind to device/session; maintain allow‑list with TTL.</li>
            <li>Use <em>Sliding sessions</em> with absolute max lifetime (e.g., 30d) and idle timeout (e.g., 8h).</li>
          </ul>
        </div>
        <div class="card">
          <h3>Key Management</h3>
          <ul>
            <li>JWKS endpoint for rotation; maintain multiple active keys; automate rollover.</li>
            <li>Store signing keys in KMS/HSM; never in source control.</li>
          </ul>
        </div>
      </div>
    </section>

  <section id="mfa" style="scroll-margin-top:180px;">
      <h2>MFA & Passwordless</h2>
      <table>
        <tr><th>Method</th><th>Benefits</th><th>Limitations</th><th>Notes</th></tr>
        <tr><td>TOTP (Authenticator app)</td><td>Offline, cheap, good UX</td><td>Phishable during entry</td><td>Enforce time sync/drift tolerance</td></tr>
        <tr><td>WebAuthn / Passkeys</td><td class="ok">Phishing‑resistant, fast</td><td>Device policy/support variances</td><td>Great for high‑risk users</td></tr>
        <tr><td>SMS / Voice</td><td>Universal fallback</td><td class="bad">SIM swap risk; deliverability cost</td><td>Use only as fallback</td></tr>
        <tr><td>Email Magic Link</td><td>Zero password UX</td><td>Mailbox compromise risk</td><td>Short‑lived links; single‑use</td></tr>
      </table>
    </section>

  <section id="web" style="scroll-margin-top:180px;">
  <section id="modern-web-api-security" style="scroll-margin-top:120px;">
      <h2>Modern Web & API Security Patterns</h2>
      <div style="display: grid; grid-template-columns: 1fr; gap: 24px;">
        <div class="card">
          <h3>Web Security Controls</h3>
          <ul>
            <li><strong>CSRF</strong>: use SameSite and CSRF tokens; avoid storing bearer tokens in <code>localStorage</code>.</li>
            <li><strong>CORS</strong>: set explicit <code>Access-Control-Allow-Origin</code>; avoid wildcard with credentials.</li>
            <li><strong>Content Security Policy (CSP)</strong>: mitigate XSS; restrict script sources; enable Trusted Types.</li>
            <li><strong>Rate Limiting</strong>: per IP/user/device for login, OTP verify, and password reset.</li>
            <li><strong>Brute Force Defense</strong>: exponential backoff; soft lockouts; challenge with CAPTCHA or WebAuthn.</li>
            <li><strong>Account Lockout</strong>: temporary (e.g., 3 minutes after 3 failures) with safe admin override; log events.</li>
            <li><strong>Device & Session Management</strong>: list active sessions; allow revoke; notify new sign‑ins.</li>
          </ul>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 0;">
        <div class="card">
          <h3>SPA & Mobile Clients</h3>
          <ul>
            <li>Use <strong>Authorization Code + PKCE</strong> for SPAs and native apps; avoid the implicit flow.</li>
            <li>Store tokens in memory (SPA) and refresh via HTTP‑only cookie or backend for frontend (BFF) proxy.</li>
            <li>Mobile: prefer system browsers (ASWebAuthenticationSession/CustomTabs) vs embedded views.</li>
            <li>Handle deep links & state to resume after login.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Microservices & APIs</h3>
          <ul>
            <li>Verify JWT at the edge or gateway; propagate <code>sub</code>, <code>roles</code>, <code>permissions</code>.</li>
            <li>Between services: use <strong>mTLS</strong> and short‑lived <strong>service tokens</strong> (client credentials/STS).</li>
            <li>Prefer <strong>BFF pattern</strong> for SPAs to centralize secrets and CSRF protection.</li>
            <li>Cache JWKs with TTL; handle key rotation seamlessly.</li>
          </ul>
        </div>
      </div>
    </section>

  <section id="roles" style="scroll-margin-top:120px;">
      <h2>Authorization Models</h2>
      <table>
        <tr><th>Model</th><th>Benefits</th><th>Limitations</th><th>Use when…</th></tr>
        <tr><td>RBAC</td><td>Simple, stable permissions</td><td>Role explosion</td><td>Clear job roles; admin panels</td></tr>
        <tr><td>ABAC</td><td>Contextual decisions</td><td>Policy complexity</td><td>Attribute‑rich domains</td></tr>
        <tr><td>ReBAC (Relationships)</td><td>Graph‑based sharing</td><td>Operational overhead</td><td>Docs, social, multi‑tenant sharing</td></tr>
        <tr><td>Policy Engines</td><td>Decoupled, auditable</td><td>Latency if remote</td><td>Large orgs, fine‑grained control</td></tr>
      </table>
    </section>

  <section id="ops" style="scroll-margin-top:180px;">
      <h2>Operations, Privacy & Compliance</h2>
      <ul>
        <li><strong>Secrets</strong>: manage via Vaults/KMS; least privilege; rotate regularly.</li>
        <li><strong>Logging</strong>: capture login, MFA challenges, token issuance/refresh, lockouts (avoid PII in logs).</li>
        <li><strong>PII & Privacy</strong>: data minimization, encryption at rest, retention policies, regional storage.</li>
        <li><strong>Availability</strong>: IdP HA, circuit breakers, cached JWKS, degraded modes (read‑only).</li>
        <li><strong>Compliance</strong>: map controls to frameworks (e.g., SOC2/ISO 27001); document DPA/consent.</li>
      </ul>
    </section>

  <section id="tradeoffs" style="scroll-margin-top:180px;">
      <h2>Benefits & Limitations — Decision Matrix</h2>
      <table>
        <tr><th>Choice</th><th>Benefits</th><th>Limitations / Risks</th><th>Mitigations</th></tr>
        <tr><td>Hosted IdP</td><td>Fast to market, rich features</td><td>Cost, lock‑in</td><td>Abstract via OIDC; export users regularly</td></tr>
        <tr><td>DIY Auth</td><td>Full control</td><td>Security burden, slower</td><td>Use vetted libs; pen‑test; ASVS controls</td></tr>
        <tr><td>JWT</td><td>Stateless scale</td><td>Revocation hard</td><td>Short TTL + refresh rotation; introspection</td></tr>
        <tr><td>Cookies</td><td>Built‑in browser security</td><td>Stateful infra</td><td>Distributed session store</td></tr>
        <tr><td>Passkeys</td><td>Phishing‑resistant</td><td>Device support/policy</td><td>Progressive enhancement + fallback</td></tr>
      </table>
    </section>

  <section id="checklists" style="scroll-margin-top:180px;">
      <h2>Checklists & Playbooks</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <div>
          <h3>Threat Modeling (quick STRIDE)</h3>
          <ul>
            <li><strong>Spoofing</strong>: credential stuffing, phishing → MFA, WebAuthn, IP throttling.</li>
            <li><strong>Tampering</strong>: token modification → signatures, audience check.</li>
            <li><strong>Repudiation</strong>: audit trails, signed logs.</li>
            <li><strong>Information Disclosure</strong>: TLS, PII minimization, encrypted secrets.</li>
            <li><strong>Denial of Service</strong>: rate limits, CAPTCHA after thresholds.</li>
            <li><strong>Elevation of Privilege</strong>: least privilege, step‑up auth for sensitive actions.</li>
          </ul>
        </div>
        <div>
          <h3>Rollout Plan</h3>
          <ol>
            <li>Choose flow (OIDC + PKCE or sessions) and IdP.</li>
            <li>Define claims & scopes; design roles/permissions.</li>
            <li>Implement login, refresh, logout, session/device pages.</li>
            <li>Add MFA & recovery flows; email/phone verification.</li>
            <li>Harden: CSP, SameSite, CSRF, rate limiters.</li>
            <li>Observability: auth events, dashboards, alerts.</li>
            <li>Run security tests, pen‑tests; plan incident response.</li>
          </ol>
        </div>
      </div>
    </section>

  <section id="snippets" style="scroll-margin-top:180px;">
      <h2>Practical Snippets</h2>
      <style>
        .tab-container { margin-top: 18px; }
        .tab-buttons { display: flex; gap: 8px; margin-bottom: 0; }
        .tab-btn { background: var(--chip); border: 1px solid var(--border); color: var(--muted); border-radius: 8px 8px 0 0; padding: 8px 18px; cursor: pointer; font-size: 1rem; outline: none; }
        .tab-btn.active { background: var(--panel); color: var(--ink); border-bottom: 1px solid var(--panel); }
        .tab-content { background: var(--panel); border: 1px solid var(--border); border-radius: 0 0 12px 12px; padding: 18px; margin-top: -1px; }
        .tab-content > pre, .tab-content > ul { margin: 0; }
      </style>
      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-btn active" onclick="showTab(0)">Session Cookie</button>
          <button class="tab-btn" onclick="showTab(1)">JWT Middleware</button>
          <button class="tab-btn" onclick="showTab(2)">CSRF Token</button>
          <button class="tab-btn" onclick="showTab(3)">PKCE Helper</button>
          <button class="tab-btn" onclick="showTab(4)">Logout Patterns</button>
        </div>
        <div class="tab-content" id="tab0">
          <h3>Set a Secure Session Cookie (Node/Express)</h3>
          <pre><code>// login handler (pseudo‑code)
    res.cookie('sid', sessionId, {
      httpOnly: true,
      secure: true,          // only over HTTPS
      sameSite: 'lax',       // 'strict' for extra CSRF protection on same‑site apps
      path: '/',
      maxAge: 1000 * 60 * 30 // 30 minutes
    });</code></pre>
        </div>
        <div class="tab-content" id="tab1" style="display:none;">
          <h3>Verify JWT (API Middleware, Node/Express)</h3>
          <pre><code>import jwt from 'jsonwebtoken';
    const JWKS = /* cache and rotate keys via JWKS URL */

    export function auth(requiredScope) {
      return async (req, res, next) => {
        const token = (req.headers.authorization||'').replace(/^Bearer\\s+/,'');
        try {
          const key = await selectKeyFromJWKS(token, JWKS);
          const payload = jwt.verify(token, key, { algorithms:['RS256'], audience:'api://default', issuer:'https://idp.example.com' });
          if (requiredScope && !payload.scope?.includes(requiredScope)) return res.status(403).end();
          req.user = payload; next();
        } catch (e) { return res.status(401).json({error:'invalid_token'}); }
      }
    }</code></pre>
        </div>
        <div class="tab-content" id="tab2" style="display:none;">
          <h3>CSRF Double‑Submit Token (Express)</h3>
          <pre><code>// On GET form:
    const csrf = randomToken();
    res.cookie('csrf', csrf, { httpOnly: false, sameSite: 'strict', secure: true });
    res.render('form', { csrf });

    // On POST handler:
    if (req.cookies.csrf !== req.body.csrf) return res.status(403).end();</code></pre>
        </div>
        <div class="tab-content" id="tab3" style="display:none;">
          <h3>PKCE Helper (Client)</h3>
          <pre><code>async function pkcePair(){
      const rnd = crypto.getRandomValues(new Uint8Array(32));
      const v = btoa(String.fromCharCode(...rnd)).replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=+$/,'');
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(v));
      const c = btoa(String.fromCharCode(...new Uint8Array(buf))).replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=+$/,'');
      return { code_verifier: v, code_challenge: c };
    }</code></pre>
        </div>
        <div class="tab-content" id="tab4" style="display:none;">
          <h3>Logout Patterns</h3>
          <ul>
            <li><strong>App logout</strong>: clear session/cookies; revoke refresh tokens.</li>
            <li><strong>Global logout</strong>: front‑channel (redirect to IdP) + back‑channel (IdP calls app endpoint).</li>
          </ul>
        </div>
      </div>
    </section>
    <!-- Glossary section moved to end -->
  <section id="glossary" style="scroll-margin-top:180px;">
      <h2>Glossary</h2>
      <style>
        .glossary-tab-container { margin-top: 18px; }
        .glossary-tab-buttons { display: flex; gap: 8px; margin-bottom: 0; flex-wrap: wrap; }
        .glossary-tab-btn { background: var(--chip); border: 1px solid var(--border); color: var(--muted); border-radius: 8px 8px 0 0; padding: 8px 18px; cursor: pointer; font-size: 1rem; outline: none; }
        .glossary-tab-btn.active { background: var(--panel); color: var(--ink); border-bottom: 1px solid var(--panel); }
        .glossary-tab-content { background: var(--panel); border: 1px solid var(--border); border-radius: 0 0 12px 12px; padding: 18px; margin-top: -1px; }
        .glossary-tab-content > table { width: 100%; border-collapse: collapse; }
        .glossary-tab-content th, .glossary-tab-content td { padding: 10px 14px; border-bottom: 1px solid var(--border); vertical-align: top; }
        .glossary-tab-content th { background: #18204a; color: #e7ebff; text-align: left; }
      </style>
      <div class="glossary-tab-container">
        <div class="glossary-tab-buttons">
          <button class="glossary-tab-btn active" onclick="showGlossaryTab(0)">Core Concepts</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(1)">Auth Factors & Methods</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(2)">Protocols & Standards</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(3)">Token & Session</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(4)">Security Patterns</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(5)">AuthZ Models</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(6)">Infrastructure & Tools</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(7)">Security Practices</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(8)">Development Concepts</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(9)">Operations & Deployment</button>
          <button class="glossary-tab-btn" onclick="showGlossaryTab(10)">Business Considerations</button>
        </div>
        <div class="glossary-tab-content" id="glossarytab0">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>Authentication (AuthN)</td><td>Verifying the identity of a user or system.</td></tr>
            <tr><td>Authorization (AuthZ)</td><td>Determining what actions a user or system is allowed to perform.</td></tr>
            <tr><td>Full-Stack Development</td><td>Building both frontend and backend components of an application.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab1" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>Passwords</td><td>Secret strings used to authenticate users.</td></tr>
            <tr><td>OTP</td><td>One-Time Password, a temporary code for authentication.</td></tr>
            <tr><td>WebAuthn</td><td>Web Authentication standard for passwordless login using public-key cryptography.</td></tr>
            <tr><td>Passkeys</td><td>Device-based credentials for passwordless authentication.</td></tr>
            <tr><td>MFA</td><td>Multi-Factor Authentication, using two or more verification methods.</td></tr>
            <tr><td>TOTP</td><td>Time-based One-Time Password, generated by an app for MFA.</td></tr>
            <tr><td>SMS</td><td>Text message used for sending authentication codes.</td></tr>
            <tr><td>Email</td><td>Email-based authentication or verification.</td></tr>
            <tr><td>Passwordless</td><td>Authentication without using passwords, often via magic links or biometrics.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab2" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>OAuth2</td><td>Authorization framework for delegated access to resources.</td></tr>
            <tr><td>OIDC</td><td>OpenID Connect, identity layer on top of OAuth2.</td></tr>
            <tr><td>PKCE</td><td>Proof Key for Code Exchange, OAuth2 extension for public clients.</td></tr>
            <tr><td>SAML 2.0</td><td>XML-based standard for exchanging authentication and authorization data.</td></tr>
            <tr><td>SCIM</td><td>Standard for automating user provisioning across domains.</td></tr>
            <tr><td>FIDO2</td><td>Modern standard for passwordless authentication using hardware authenticators.</td></tr>
            <tr><td>LDAP</td><td>Protocol for accessing and maintaining directory information services.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab3" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>JWT</td><td>JSON Web Token, compact token for securely transmitting claims.</td></tr>
            <tr><td>PASETO</td><td>Platform-Agnostic Security Tokens, secure alternative to JWT.</td></tr>
            <tr><td>Session Cookie</td><td>Cookie used to maintain a user's session with a server.</td></tr>
            <tr><td>Cookies</td><td>Small pieces of data stored by the browser for session management.</td></tr>
            <tr><td>Tokens</td><td>Digital credentials used for authentication and authorization.</td></tr>
            <tr><td>Refresh Tokens</td><td>Tokens used to obtain new access tokens without re-authenticating.</td></tr>
            <tr><td>Session Design</td><td>Approach to managing user sessions in an application.</td></tr>
            <tr><td>Token Storage</td><td>Methods for securely storing authentication tokens.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab4" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>CSRF</td><td>Cross-Site Request Forgery, attack tricking users into unwanted actions.</td></tr>
            <tr><td>XSS</td><td>Cross-Site Scripting, attack injecting malicious scripts into websites.</td></tr>
            <tr><td>CORS</td><td>Cross-Origin Resource Sharing, controls resource access between domains.</td></tr>
            <tr><td>SameSite</td><td>Cookie attribute restricting cross-site requests.</td></tr>
            <tr><td>Rate Limits</td><td>Restrictions on the number of allowed requests in a time period.</td></tr>
            <tr><td>CAPTCHA</td><td>Challenge to distinguish humans from bots.</td></tr>
            <tr><td>TLS</td><td>Transport Layer Security, protocol for encrypting data in transit.</td></tr>
            <tr><td>CSP</td><td>Content Security Policy, helps prevent XSS attacks.</td></tr>
            <tr><td>Phishing</td><td>Fraudulent attempt to obtain sensitive information.</td></tr>
            <tr><td>Credential Stuffing</td><td>Attack using stolen credentials to gain unauthorized access.</td></tr>
            <tr><td>IP Throttling</td><td>Limiting requests from a single IP address.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab5" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>RBAC</td><td>Role-Based Access Control, authorization based on user roles.</td></tr>
            <tr><td>ABAC</td><td>Attribute-Based Access Control, authorization based on attributes.</td></tr>
            <tr><td>ReBAC</td><td>Relationship-Based Access Control, authorization based on relationships.</td></tr>
            <tr><td>Policy Engines</td><td>Systems for managing and enforcing authorization policies.</td></tr>
            <tr><td>Roles</td><td>Defined sets of permissions assigned to users.</td></tr>
            <tr><td>Permissions</td><td>Specific actions a user is allowed to perform.</td></tr>
            <tr><td>Scopes</td><td>Defined boundaries for access within an application.</td></tr>
            <tr><td>Claims</td><td>Statements about a user, often found in tokens.</td></tr>
            <tr><td>Least Privilege</td><td>Security principle of granting only necessary permissions.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab6" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>IdP</td><td>Identity Provider, manages user identities and authentication.</td></tr>
            <tr><td>HSM</td><td>Hardware Security Module, device for secure key management.</td></tr>
            <tr><td>KMS</td><td>Key Management Service, service for managing cryptographic keys.</td></tr>
            <tr><td>BFF</td><td>Backend for Frontend, backend tailored for a specific frontend.</td></tr>
            <tr><td>API Gateway</td><td>Service that manages and secures API traffic.</td></tr>
            <tr><td>Microservices</td><td>Architecture style of building applications as small, independent services.</td></tr>
            <tr><td>Distributed Session Store</td><td>System for storing session data across multiple servers.</td></tr>
            <tr><td>JWKS</td><td>JSON Web Key Set, format for publishing public keys for token verification.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab7" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>Threat Modeling</td><td>Process of identifying and addressing security risks.</td></tr>
            <tr><td>STRIDE</td><td>Framework for categorizing security threats: Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege.</td></tr>
            <tr><td>Pen-Testing</td><td>Testing systems for vulnerabilities by simulating attacks.</td></tr>
            <tr><td>Audit Trails</td><td>Records of system activity for security and compliance.</td></tr>
            <tr><td>Secrets Management</td><td>Secure storage and handling of sensitive credentials.</td></tr>
            <tr><td>Key Rotation</td><td>Regularly changing cryptographic keys for security.</td></tr>
            <tr><td>Logging</td><td>Recording system events for monitoring and troubleshooting.</td></tr>
            <tr><td>Privacy</td><td>Protecting user data from unauthorized access.</td></tr>
            <tr><td>PII Minimization</td><td>Reducing the amount of personally identifiable information collected.</td></tr>
            <tr><td>Compliance</td><td>Adhering to legal and regulatory requirements.</td></tr>
            <tr><td>ASVS</td><td>Application Security Verification Standard, framework for security requirements.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab8" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>Middleware</td><td>Software that connects different components or applications.</td></tr>
            <tr><td>Express</td><td>Popular Node.js web application framework.</td></tr>
            <tr><td>Node.js</td><td>JavaScript runtime for building server-side applications.</td></tr>
            <tr><td>API Security</td><td>Protecting APIs from unauthorized access and attacks.</td></tr>
            <tr><td>Web Security</td><td>Practices for securing web applications.</td></tr>
            <tr><td>SPA</td><td>Single Page Application, web app that loads a single HTML page and updates dynamically.</td></tr>
            <tr><td>Mobile Authentication</td><td>Methods for verifying users on mobile devices.</td></tr>
            <tr><td>Frontend</td><td>User-facing part of an application.</td></tr>
            <tr><td>Backend</td><td>Server-side part of an application.</td></tr>
            <tr><td>Observability</td><td>Ability to monitor and understand system behavior.</td></tr>
            <tr><td>Incident Response</td><td>Process for handling and mitigating security incidents.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab9" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>Rollout Plan</td><td>Strategy for deploying new features or systems.</td></tr>
            <tr><td>Security Tests</td><td>Tests to ensure systems are secure against threats.</td></tr>
            <tr><td>Device Management</td><td>Administering and securing user devices.</td></tr>
            <tr><td>Session Management</td><td>Handling user sessions securely and efficiently.</td></tr>
            <tr><td>User Provisioning</td><td>Creating and managing user accounts and access.</td></tr>
            <tr><td>Email Verification</td><td>Confirming user email addresses for security.</td></tr>
            <tr><td>Phone Verification</td><td>Confirming user phone numbers for security.</td></tr>
            <tr><td>Recovery Flows</td><td>Processes for regaining access to accounts.</td></tr>
            <tr><td>Logout Patterns</td><td>Methods for securely ending user sessions.</td></tr>
            <tr><td>Global Logout</td><td>Logging out from all connected services.</td></tr>
            <tr><td>Front-Channel</td><td>Logout or communication via browser redirects.</td></tr>
            <tr><td>Back-Channel</td><td>Logout or communication via direct server calls.</td></tr>
          </table>
        </div>
        <div class="glossary-tab-content" id="glossarytab10" style="display:none;">
          <table><tr><th>Term</th><th>Definition</th></tr>
            <tr><td>UX</td><td>User Experience, overall experience of a user interacting with a system.</td></tr>
            <tr><td>Maintainability</td><td>Ease of maintaining and updating a system.</td></tr>
            <tr><td>Lock-in</td><td>Dependence on a particular vendor or technology.</td></tr>
            <tr><td>Cost</td><td>Financial expense associated with a solution.</td></tr>
            <tr><td>Vendor Selection</td><td>Choosing providers for services or products.</td></tr>
            <tr><td>Hosted IdP</td><td>Identity provider hosted by a third party.</td></tr>
            <tr><td>DIY Auth</td><td>Building authentication systems in-house.</td></tr>
          </table>
        </div>
      </div>
      <script>
        function showGlossaryTab(idx) {
          var tabs = document.querySelectorAll('.glossary-tab-content');
          var btns = document.querySelectorAll('.glossary-tab-btn');
          tabs.forEach(function(tab, i) {
            tab.style.display = (i === idx) ? '' : 'none';
          });
          btns.forEach(function(btn, i) {
            if (i === idx) btn.classList.add('active');
            else btn.classList.remove('active');
          });
        }
      </script>
    </section>
  </div>
  <script>
    function showTab(idx) {
      var tabs = document.querySelectorAll('.tab-content');
      var btns = document.querySelectorAll('.tab-btn');
      tabs.forEach(function(tab, i) {
        tab.style.display = (i === idx) ? '' : 'none';
      });
      btns.forEach(function(btn, i) {
        if (i === idx) btn.classList.add('active');
        else btn.classList.remove('active');
      });
    }
  </script>
<script>
    function showCoreTab(idx) {
      var tabs = document.querySelectorAll('.core-tab-content');
      var btns = document.querySelectorAll('.core-tab-btn');
      tabs.forEach(function(tab, i) {
        tab.style.display = (i === idx) ? '' : 'none';
      });
      btns.forEach(function(btn, i) {
        if (i === idx) btn.classList.add('active');
        else btn.classList.remove('active');
      });
    }
  </script>
</body>
</html>
